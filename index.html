<html>
    <header>This is a random-choose-people project</header>
<head>
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.js"></script>
    <script>
        function _(str){
			return $(str).get(0)
        }
        function OrganizeData(data){
            while (_(".studentlist") != null){
                _("#table").removeChild(_(".studentlist"))
            }
            var infor = []
            while (data.indexOf(";") != -1){
                var subdata = data.substring(0,data.indexOf(";")) + ","
                var subinfor = []
                while (subdata.indexOf(",") != -1){
                    subinfor.push(subdata.slice(0,subdata.indexOf(",")))
                    subdata = subdata.substring(subdata.indexOf(",")+1,subdata.length)
                }
                infor.push(subinfor)
                var data = data.substring(data.indexOf(";")+1,data.length)
            }
            for (i in infor){
                var newrow = document.createElement("tr")
                var newcell = document.createElement("td")
                var newimg = document.createElement("img")
                newimg.setAttribute("src",infor[i][1])
                newcell.innerHTML = infor[i][0]
                newcell.appendChild(newimg)
                newrow.appendChild(newcell)
                newrow.setAttribute("class","studentlist")
                _("#table").appendChild(newrow)
            }
        }
        function ChooseRequest(){
            $.ajax({ url:"choose.php",type:"POST",data:{},
                success: function (data){ 
                    
                    _("#return").innerHTML = data
                },
                beforeSend: function(xhr){
                    xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded")
                }
            })
        }
        function AddRequest(){
            var newimg = new FormData()
            newimg.append("file",_("#img").files[0])
            newimg.append("name",inputname)
            $.ajax({ url:"add.php",type:"POST",data:newimg,
                contentType:false,
                processData:false,
                success : function (data){
                    refresh()
                    _("#confirm").innerHTML = data
                }
            })
        }
        function refresh(){
            $.ajax({ url:"refresh.php",type:"POST",data:{},
                success: function (data){ 
                    OrganizeData(data)
                    //_("#table").innerHTML = data
                },
                beforeSend: function(xhr){
                    xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded")
                }
            })
        }
        $(document).ready(function(){
            refresh()
            $("#choose").click(function(){
                ChooseRequest()
            })
            $("#add").click(function(){
                inputname = _("#addpeople").value
                AddRequest()
            })

            setInterval(function(){
                    
                },100)
        })
    </script>
    </head>
    <body>
        
        <div>
            <table id = "table" border="1" >
            </table>
        </div>

        <div class = "return">
            <span id = "return"></span>
        </div>

        <div class = "choose">
            <button id = "choose">choose people</button>
        </div>

        <div>
            <button id = "add">add people</button>
            <input id = "addpeople">
            <br>
            <input type = "file" id = "img">upload picture
            <br>
            <span id = "confirm"></span>
        </div>
    
    </body>
</html>